Vue.directive("sortable",{bind:function(){var e=jQuery(this.el);e.sortable({handle:".wedocs-btn-reorder",stop:function(e,t){var o=[];jQuery(t.item.closest("ul")).children("li").each(function(e,t){o.push(jQuery(t).data("id"))}),wp.ajax.post({action:"wedocs_sortable_docs",ids:o,_wpnonce:weDocs.nonce})},cursor:"move"})}}),new Vue({el:"#wedocs-app",data:{editurl:"",viewurl:"",docs:[]},ready:function(){var e=this,t=jQuery(e.$el);this.editurl=weDocs.editurl,this.viewurl=weDocs.viewurl,t.find("ul.docs").removeClass("not-loaded").addClass("loaded"),jQuery.get(ajaxurl,{action:"wedocs_admin_get_docs",_wpnonce:weDocs.nonce},function(o){t.find(".spinner").remove(),t.find(".no-docs").removeClass("not-loaded"),e.docs=o.data})},methods:{onError:function(e){alert(e)},addDoc:function(){var e=this;this.docs=this.docs||[],swal({title:weDocs.enter_doc_title,type:"input",showCancelButton:!0,closeOnConfirm:!0,animation:"slide-from-top",inputPlaceholder:weDocs.write_something},function(t){return t===!1?!1:void wp.ajax.send({data:{action:"wedocs_create_doc",title:t,parent:0,_wpnonce:weDocs.nonce},success:function(t){e.docs.unshift(t)},error:this.onError})})},removeDoc:function(e,t){var o=this;swal({title:"Are you sure?",text:"Are you sure to delete the entire documentation? Sections and articles inside this doc will be deleted too!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){o.removePost(e,t)})},addSection:function(e){swal({title:weDocs.enter_section_title,type:"input",showCancelButton:!0,closeOnConfirm:!0,animation:"slide-from-top",inputPlaceholder:weDocs.write_something},function(t){return t===!1?!1:(t=t.trim(),void(t&&wp.ajax.send({data:{action:"wedocs_create_doc",title:t,parent:e.post.id,order:e.child.length,_wpnonce:weDocs.nonce},success:function(t){e.child.push(t)},error:this.onError})))})},removeSection:function(e,t){var o=this;swal({title:"Are you sure?",text:"Are you sure to delete the entire section? Articles inside this section will be deleted too!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){o.removePost(e,t)})},addArticle:function(e,event){var t=event;swal({title:weDocs.enter_doc_title,type:"input",showCancelButton:!0,closeOnConfirm:!0,animation:"slide-from-top",inputPlaceholder:weDocs.write_something},function(o){return o===!1?!1:void wp.ajax.send({data:{action:"wedocs_create_doc",title:o,parent:e.post.id,status:"draft",order:e.child.length,_wpnonce:weDocs.nonce},success:function(o){e.child.push(o);var n=jQuery(t.target).closest(".section-title").next();n.hasClass("collapsed")&&n.removeClass("collapsed")},error:function(e){alert(e)}})})},removeArticle:function(e,t){var o=this;swal({title:"Are you sure?",text:"Are you sure to delete the article?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){o.removePost(e,t)})},removePost:function(e,t,o){o=o||"This post has been deleted",wp.ajax.send({data:{action:"wedocs_remove_doc",id:e.post.id,_wpnonce:weDocs.nonce},success:function(){t.$remove(e),swal("Deleted!",o,"success")},error:function(e){alert(e)}})},toggleCollapse:function(e){jQuery(e.target).siblings("ul.articles").toggleClass("collapsed")}}});
